<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            color: white;
            min-height: 100vh;
            padding: 1rem;
        }
        .header { 
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .btn {
            padding: 0.6rem 1.2rem;
            border: none;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .btn-green { background: #10b981; color: white; }
        .btn-red { background: #ef4444; color: white; }
        .btn-yellow { background: #fbbf24; color: black; }
        .btn-disabled { background: #4b5563; color: #9ca3af; cursor: not-allowed; }
        .btn:active:not(.btn-disabled) { transform: scale(0.95); }
        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 1rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        .price-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); 
            gap: 0.75rem; 
            margin-bottom: 1rem;
        }
        .price-card {
            background: rgba(255,255,255,0.05);
            border-left: 4px solid #f59e0b;
            padding: 0.75rem;
            border-radius: 0.5rem;
        }
        .price-value { 
            font-size: 1.2rem; 
            font-weight: bold; 
            color: #fbbf24; 
            margin: 0.5rem 0;
        }
        .text-sm { font-size: 0.8rem; }
        .text-gray { color: #9ca3af; }
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        .modal.show { display: flex; }
        .modal-content {
            background: #1e293b;
            padding: 2rem;
            border-radius: 1rem;
            max-width: 400px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }
        input {
            width: 100%;
            padding: 0.75rem;
            margin: 0.5rem 0;
            border: none;
            border-radius: 0.5rem;
            background: #334155;
            color: white;
            font-size: 1rem;
        }
        input:focus { outline: 2px solid #10b981; }
        h1 { font-size: 1.3rem; }
        h2 { margin-bottom: 1rem; }
        h3 { margin-bottom: 0.5rem; font-size: 1.1rem; }
        .welcome {
            text-align: center;
            padding: 3rem 1rem;
        }
        .welcome h2 { font-size: 2rem; margin-bottom: 1rem; }
        .status-badge {
            background: #fbbf24;
            color: black;
            padding: 0.3rem 0.6rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            margin-right: 0.5rem;
            display: inline-block;
        }
        .loading {
            text-align: center;
            padding: 3rem 1rem;
        }
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.1);
            border-top-color: #10b981;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error {
            background: #7f1d1d;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 1rem 0;
            border: 1px solid #ef4444;
        }
    </style>
</head>
<body>

<div id="app">
    <div class="loading">
        <div class="spinner"></div>
        <div>Ø¯Ø± Ø­Ø§Ù„ Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±...</div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<script>
(function() {
    'use strict';
    
    console.log('âœ… App started');

    // âš ï¸âš ï¸âš ï¸ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Supabase Ø®ÙˆØ¯ Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯ âš ï¸âš ï¸âš ï¸
    const SUPABASE_URL = 'https://mbigvlhecgfjjemvmzjf.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1iaWd2bGhlY2dmamplbXZtempmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NTg0MDQsImV4cCI6MjA4MzAzNDQwNH0.sbv2qvAUEB3rnnsrmut_o1hsAhhyTR_o5FZiJ4zOPeo';

    const hasValidKeys = SUPABASE_URL !== 'YOUR_SUPABASE_URL' && 
                         SUPABASE_ANON_KEY !== 'YOUR_SUPABASE_ANON_KEY' &&
                         SUPABASE_URL.includes('supabase.co');

    console.log('ğŸ”‘ Valid keys:', hasValidKeys);

    let supabaseClient = null;
    let currentUser = null;
    let isSubscribed = false;

    const prices = {
        goldPrice: 2700,
        silverPrice: 32,
        usdRate: 108000,
        mesghalMarket: 48500000,
        geram18Market: 3550000,
        dirhamRate: 29500
    };

    function formatNumber(num) {
        return new Intl.NumberFormat('fa-IR').format(Math.round(num));
    }

    function calculate() {
        const MESGHAL_DIVIDER = 9.5742;
        const GRAM_PER_OUNCE = 31.1;
        
        const mesghalTheo = (prices.goldPrice * prices.usdRate) / MESGHAL_DIVIDER;
        const diffMesghal = mesghalTheo - prices.mesghalMarket;
        const mesghalPercent = ((diffMesghal / prices.mesghalMarket) * 100).toFixed(2);
        
        const geram18Theo = ((prices.goldPrice / GRAM_PER_OUNCE) * prices.usdRate) * 0.75;
        const diffGeram18 = geram18Theo - prices.geram18Market;
        const geram18Percent = ((diffGeram18 / prices.geram18Market) * 100).toFixed(2);
        
        const gsRatio = (prices.goldPrice / prices.silverPrice).toFixed(2);
        
        return { mesghalTheo, diffMesghal, mesghalPercent, geram18Theo, diffGeram18, geram18Percent, gsRatio };
    }

    function showErrorPage(message) {
        document.getElementById('app').innerHTML = `
            <div class="card">
                <div class="error">
                    <h2>âš ï¸ Ø®Ø·Ø§</h2>
                    <p style="margin: 1rem 0;">${message}</p>
                    <button class="btn btn-green" onclick="window.location.reload()">ğŸ”„ ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button>
                </div>
            </div>
        `;
    }

    function renderWelcomePage() {
        const calc = calculate();
        
        document.getElementById('app').innerHTML = `
            <div class="header">
                <h1>ğŸ’ Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ</h1>
                <div>
                    <button class="btn btn-green" onclick="window.showModal('login')">ÙˆØ±ÙˆØ¯</button>
                    <button class="btn btn-yellow" onclick="window.showModal('register')">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button>
                </div>
            </div>
            
            <div class="welcome">
                <h2>Ø¨Ù‡ Ú¯Ù„Ø¯ÛŒØ§Ø± Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯</h2>
                <p style="color: #9ca3af; margin-bottom: 2rem;">
                    ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§<br>
                    Ø¨Ø±Ø§ÛŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ú©Ø§Ù…Ù„ØŒ Ù„Ø·ÙØ§ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯
                </p>
                <button class="btn btn-green" onclick="window.showModal('register')" style="padding: 1rem 2rem; font-size: 1.1rem;">
                    ğŸš€ Ø´Ø±ÙˆØ¹ Ø±Ø§ÛŒÚ¯Ø§Ù†
                </button>
            </div>

            <div style="opacity: 0.5; pointer-events: none;">
                <div class="price-grid">
                    <div class="price-card">
                        <div class="text-sm text-gray">ğŸŒ Ø§Ù†Ø³ Ø·Ù„Ø§</div>
                        <div class="price-value">${formatNumber(prices.goldPrice)}</div>
                        <div class="text-sm text-gray">Ø¯Ù„Ø§Ø±</div>
                    </div>
                    <div class="price-card">
                        <div class="text-sm text-gray">ğŸ’µ Ø¯Ù„Ø§Ø±</div>
                        <div class="price-value">${formatNumber(prices.usdRate)}</div>
                        <div class="text-sm text-gray">ØªÙˆÙ…Ø§Ù†</div>
                    </div>
                    <div class="price-card">
                        <div class="text-sm text-gray">âš–ï¸ Ù…Ø«Ù‚Ø§Ù„</div>
                        <div class="price-value">${formatNumber(prices.mesghalMarket)}</div>
                        <div class="text-sm text-gray">ØªÙˆÙ…Ø§Ù†</div>
                    </div>
                </div>
            </div>

            ${renderModals()}
        `;
    }

    function renderDashboard() {
        const calc = calculate();
        
        document.getElementById('app').innerHTML = `
            <div class="header">
                <div>
                    <h1>ğŸ’ Ú¯Ù„Ø¯ÛŒØ§Ø±</h1>
                    ${isSubscribed ? '<span class="status-badge">â­ PRO</span>' : ''}
                </div>
                <div>
                    ${!isSubscribed ? '<button class="btn btn-yellow" onclick="window.showModal(\'subscribe\')">â­ Ø§Ø±ØªÙ‚Ø§</button>' : ''}
                    <button class="btn btn-red" onclick="window.handleLogout()" style="margin-right: 0.5rem;">Ø®Ø±ÙˆØ¬</button>
                </div>
            </div>

            <div class="card">
                <div class="text-sm" style="color: #10b981;">
                    âœ… ${currentUser.email}
                </div>
                <div class="text-sm text-gray" style="margin-top: 0.25rem;">
                    ${isSubscribed ? 'â­ Ø§Ø´ØªØ±Ø§Ú© Ù¾Ø±Ùˆ ÙØ¹Ø§Ù„ - Ù‚Ø§Ø¨Ù„ÛŒØª ÙˆÛŒØ±Ø§ÛŒØ´ ÙØ¹Ø§Ù„' : 'ğŸ“¦ Ù†Ø³Ø®Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† - Ø¨Ø±Ø§ÛŒ ÙˆÛŒØ±Ø§ÛŒØ´ Ø¨Ù‡ Ù¾Ø±Ùˆ Ø§Ø±ØªÙ‚Ø§ Ø¯Ù‡ÛŒØ¯'}
                </div>
            </div>

            <div class="price-grid">
                ${renderPriceCard('ğŸŒ Ø§Ù†Ø³ Ø·Ù„Ø§', prices.goldPrice, 'Ø¯Ù„Ø§Ø±', 'goldPrice')}
                ${renderPriceCard('âšª Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡', prices.silverPrice, 'Ø¯Ù„Ø§Ø±', 'silverPrice')}
                ${renderPriceCard('ğŸ’µ Ø¯Ù„Ø§Ø±', prices.usdRate, 'ØªÙˆÙ…Ø§Ù†', 'usdRate')}
                ${renderPriceCard('âš–ï¸ Ù…Ø«Ù‚Ø§Ù„', prices.mesghalMarket, 'ØªÙˆÙ…Ø§Ù†', 'mesghalMarket')}
                ${renderPriceCard('ğŸ’ 18 Ø¹ÛŒØ§Ø±', prices.geram18Market, 'Øª/Ú¯Ø±Ù…', 'geram18Market')}
                ${renderPriceCard('ğŸ‡¦ğŸ‡ª Ø¯Ø±Ù‡Ù…', prices.dirhamRate, 'ØªÙˆÙ…Ø§Ù†', 'dirhamRate')}
            </div>

            ${renderAnalysisCard('ğŸ“Š ØªØ­Ù„ÛŒÙ„ Ù…Ø«Ù‚Ø§Ù„', prices.mesghalMarket, calc.mesghalTheo, calc.diffMesghal, calc.mesghalPercent)}
            ${renderAnalysisCard('ğŸ“Š ØªØ­Ù„ÛŒÙ„ 18 Ø¹ÛŒØ§Ø±', prices.geram18Market, calc.geram18Theo, calc.diffGeram18, calc.geram18Percent)}

            <div class="card">
                <h3>ğŸ“Š Ù†Ø³Ø¨Øª Ø·Ù„Ø§ Ø¨Ù‡ Ù†Ù‚Ø±Ù‡ (G/S)</h3>
                <div class="price-value" style="font-size: 2rem;">${calc.gsRatio}</div>
                <div class="text-sm text-gray">Ù‡Ø± Ø§ÙˆÙ†Ø³ Ø·Ù„Ø§ = ${calc.gsRatio} Ø§ÙˆÙ†Ø³ Ù†Ù‚Ø±Ù‡</div>
            </div>

            ${renderModals()}
        `;
    }

    function renderPriceCard(title, value, unit, key) {
        if (isSubscribed) {
            return `
                <div class="price-card">
                    <div class="text-sm text-gray">${title}</div>
                    <div class="price-value">${formatNumber(value)}</div>
                    <div class="text-sm text-gray">${unit}</div>
                    <button class="btn btn-yellow" onclick="window.editPrice('${key}', '${title}')" style="width: 100%; padding: 0.4rem; margin-top: 0.5rem; font-size: 0.8rem;">
                        âœï¸ ÙˆÛŒØ±Ø§ÛŒØ´
                    </button>
                </div>
            `;
        } else {
            return `
                <div class="price-card">
                    <div class="text-sm text-gray">${title}</div>
                    <div class="price-value">${formatNumber(value)}</div>
                    <div class="text-sm text-gray">${unit}</div>
                    <button class="btn btn-disabled" onclick="window.showModal('subscribe')" style="width: 100%; padding: 0.4rem; margin-top: 0.5rem; font-size: 0.8rem;">
                        ğŸ”’ Ù‚ÙÙ„
                    </button>
                </div>
            `;
        }
    }

    function renderAnalysisCard(title, market, theo, diff, percent) {
        return `
            <div class="card">
                <h3>${title}</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; margin-bottom: 0.75rem;">
                    <div>
                        <div class="text-sm text-gray">Ù‚ÛŒÙ…Øª Ø¨Ø§Ø²Ø§Ø±</div>
                        <div style="font-weight: bold; margin-top: 0.25rem;">${formatNumber(market)}</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray">Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ</div>
                        <div style="font-weight: bold; margin-top: 0.25rem;">${formatNumber(theo)}</div>
                    </div>
                </div>
                <div style="background: rgba(251,191,36,0.1); padding: 0.75rem; border-radius: 0.5rem; border: 1px solid rgba(251,191,36,0.3);">
                    <div class="text-sm text-gray" style="margin-bottom: 0.5rem;">Ø§Ø®ØªÙ„Ø§Ù: ${percent}%</div>
                    <div style="font-size: 1.5rem; font-weight: bold; color: #fbbf24;">${formatNumber(Math.abs(diff))}</div>
                </div>
            </div>
        `;
    }

    function renderModals() {
        return `
            <div id="authModal" class="modal">
                <div class="modal-content">
                    <h2 id="authTitle">ÙˆØ±ÙˆØ¯</h2>
                    <input type="email" id="authEmail" placeholder="Ø§ÛŒÙ…ÛŒÙ„" autocomplete="email">
                    <input type="password" id="authPassword" placeholder="Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±)" minlength="6" autocomplete="current-password">
                    <div id="authError" class="error" style="display: none;"></div>
                    <button class="btn btn-green" onclick="window.handleAuth()" id="authBtn" style="width: 100%; margin-top: 1rem;">
                        ØªØ§ÛŒÛŒØ¯
                    </button>
                    <button class="btn" onclick="window.closeModal()" style="width: 100%; margin-top: 0.5rem; background: #334155; color: white;">
                        Ø§Ù†ØµØ±Ø§Ù
                    </button>
                </div>
            </div>

            <div id="subscribeModal" class="modal">
                <div class="modal-content" style="background: linear-gradient(135deg, #78350f 0%, #92400e 100%); border: 2px solid #fbbf24;">
                    <div style="text-align: center;">
                        <div style="font-size: 3rem;">â­</div>
                        <h2 style="margin: 1rem 0;">Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ</h2>
                        <p style="color: #fcd34d; margin-bottom: 1.5rem;">Ø§Ù…Ú©Ø§Ù† ÙˆÛŒØ±Ø§ÛŒØ´ ØªÙ…Ø§Ù… Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§</p>
                        <div style="background: rgba(255,255,255,0.2); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1.5rem;">
                            <div style="font-size: 2rem; font-weight: bold;">Û¹Û¹,Û°Û°Û° ØªÙˆÙ…Ø§Ù†</div>
                            <div style="color: #fcd34d; font-size: 0.9rem;">Ù…Ø§Ù‡Ø§Ù†Ù‡</div>
                        </div>
                        <button class="btn" onclick="window.activateSubscription()" style="width: 100%; background: white; color: #78350f; font-size: 1rem; padding: 1rem; font-weight: bold;">
                            ğŸš€ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ù¾Ø±Ùˆ
                        </button>
                        <button class="btn" onclick="window.closeModal()" style="width: 100%; margin-top: 0.5rem; background: transparent; color: #fcd34d; border: 1px solid #fcd34d;">
                            Ø¨Ø³ØªÙ†
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    let currentModalType = '';

    window.showModal = function(type) {
        currentModalType = type;
        
        if (type === 'login' || type === 'register') {
            document.getElementById('authTitle').textContent = type === 'login' ? 'ğŸ‘‹ ÙˆØ±ÙˆØ¯' : 'ğŸ‰ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…';
            document.getElementById('authError').style.display = 'none';
            document.getElementById('authModal').classList.add('show');
        } else if (type === 'subscribe') {
            document.getElementById('subscribeModal').classList.add('show');
        }
    };

    window.closeModal = function() {
        document.querySelectorAll('.modal').forEach(m => m.classList.remove('show'));
    };

    window.handleAuth = async function() {
        const email = document.getElementById('authEmail').value.trim();
        const password = document.getElementById('authPassword').value;
        const errorDiv = document.getElementById('authError');
        const btn = document.getElementById('authBtn');
        
        if (!email || !password) {
            errorDiv.textContent = 'âŒ Ù„Ø·ÙØ§ Ø§ÛŒÙ…ÛŒÙ„ Ùˆ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯';
            errorDiv.style.display = 'block';
            return;
        }
        
        if (password.length < 6) {
            errorDiv.textContent = 'âŒ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø§Ø´Ø¯';
            errorDiv.style.display = 'block';
            return;
        }
        
        btn.textContent = 'â³ Ù„Ø·ÙØ§ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...';
        btn.disabled = true;
        errorDiv.style.display = 'none';
        
        try {
            if (currentModalType === 'register') {
                const { error } = await supabaseClient.auth.signUp({ email, password });
                if (error) throw error;
                alert('âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚! Ø¯Ø± Ø­Ø§Ù„ ÙˆØ±ÙˆØ¯...');
            } else {
                const { error } = await supabaseClient.auth.signInWithPassword({ email, password });
                if (error) throw error;
            }
            window.closeModal();
        } catch (err) {
            console.error('Auth error:', err);
            errorDiv.textContent = 'âŒ ' + err.message;
            errorDiv.style.display = 'block';
        } finally {
            btn.textContent = 'ØªØ§ÛŒÛŒØ¯';
            btn.disabled = false;
        }
    };

    window.handleLogout = async function() {
        if (confirm('Ø¢ÛŒØ§ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ Ø®Ø§Ø±Ø¬ Ø´ÙˆÛŒØ¯ØŸ')) {
            await supabaseClient.auth.signOut();
        }
    };

    window.activateSubscription = async function() {
        if (!currentUser) return;
        
        try {
            const { error } = await supabaseClient
                .from('profiles')
                .update({ is_subscribed: true })
                .eq('id', currentUser.id);
            
            if (error) throw error;
            
            isSubscribed = true;
            window.closeModal();
            renderDashboard();
            alert('ğŸ‰ Ø§Ø´ØªØ±Ø§Ú© Ù¾Ø±Ùˆ ÙØ¹Ø§Ù„ Ø´Ø¯!');
        } catch (err) {
            alert('Ø®Ø·Ø§: ' + err.message);
        }
    };

    window.editPrice = function(key, title) {
        const currentValue = prices[key];
        const newValue = prompt(`Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ ${title}:`, currentValue);
        
        if (newValue) {
            const num = parseFloat(newValue.replace(/,/g, ''));
            if (!isNaN(num) && num > 0) {
                prices[key] = num;
                renderDashboard();
            } else {
                alert('âŒ Ù„Ø·ÙØ§ ÛŒÚ© Ø¹Ø¯Ø¯ Ù…Ø¹ØªØ¨Ø± ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
            }
        }
    };

    async function init() {
        console.log('ğŸš€ Initializing app...');
        
        if (!hasValidKeys) {
            showErrorPage('âš ï¸ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Supabase ÙˆØ§Ø±Ø¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.<br><br>Ù„Ø·ÙØ§ Ø¯Ø± Ú©Ø¯ HTML (Ø®Ø· 100-101)ØŒ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯.');
            return;
        }
        
        if (typeof window.supabase === 'undefined') {
            showErrorPage('âš ï¸ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Supabase Ù„ÙˆØ¯ Ù†Ø´Ø¯.<br><br>Ù„Ø·ÙØ§ Ø§ØªØµØ§Ù„ Ø§ÛŒÙ†ØªØ±Ù†Øª Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø±Ø³ÛŒ Ú©Ù†ÛŒØ¯.');
            return;
        }
        
        try {
            console.log('ğŸ”Œ Connecting to Supabase...');
            supabaseClient = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
            console.log('âœ… Supabase connected');
            
            const { data: { session } } = await supabaseClient.auth.getSession();
            
            if (session?.user) {
                currentUser = session.user;
                console.log('âœ… User logged in:', currentUser.email);
                
                try {
                    const { data: profile } = await supabaseClient
                        .from('profiles')
                        .select('is_subscribed')
                        .eq('id', currentUser.id)
                        .single();
                    isSubscribed = profile?.is_subscribed || false;
                    console.log('âœ… Subscription:', isSubscribed);
                } catch (err) {
                    console.warn('âš ï¸ Profile error:', err);
                }
                
                renderDashboard();
            } else {
                console.log('â„¹ï¸ No user logged in');
                renderWelcomePage();
            }
            
            supabaseClient.auth.onAuthStateChange(async (event, session) => {
                console.log('ğŸ”” Auth changed:', event);
                
                if (session?.user) {
                    currentUser = session.user;
                    try {
                        const { data: profile } = await supabaseClient
                            .from('profiles')
                            .select('is_subscribed')
                            .eq('id', currentUser.id)
                            .single();
                        isSubscribed = profile?.is_subscribed || false;
                    } catch (err) {
                        isSubscribed = false;
                    }
                    renderDashboard();
                } else {
                    currentUser = null;
                    isSubscribed = false;
                    renderWelcomePage();
                }
            });
            
        } catch (err) {
            console.error('âŒ Init error:', err);
            showErrorPage('âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§ØªØµØ§Ù„: ' + err.message);
        }
    }

    window.addEventListener('load', () => {
        console.log('âœ… Page loaded');
        setTimeout(init, 500);
    });

})();
</script>

</body>
</html>
