<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú¯Ù„Ø¯ÛŒØ§Ø± Ù¾Ø±Ùˆ - ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø·Ù„Ø§</title>

    <!-- Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>

    <!-- ÙÙˆÙ†Øª Ùˆ Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazirmatn', sans-serif; margin: 0; }
        #root { min-height: 100vh; }
        .loading-screen { display: flex; min-height: 100vh; align-items: center; justify-content: center; background: #0f172a; color: white; flex-direction: column; gap: 1rem; }
        .loading-spinner { width: 50px; height: 50px; border: 5px solid rgba(255,255,255,0.1); border-top-color: #10b981; border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        .animate-float { animation: float 3s ease-in-out infinite; }
    </style>
</head>
<body class="bg-slate-900">

    <div id="root">
        <div class="loading-screen">
            <div class="loading-spinner"></div>
            <div>Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ú¯Ù„Ø¯ÛŒØ§Ø±...</div>
        </div>
    </div>

    <!-- âœ…âœ…âœ… Ú©Ø¯ Ù†Ù‡Ø§ÛŒÛŒØŒ Ú©Ø§Ù…Ù„ Ùˆ Ø¨Ø§ Ù…Ø¹Ù…Ø§Ø±ÛŒ ØªØ¶Ù…ÛŒÙ†ÛŒ âœ…âœ…âœ… -->
    <script type="text/babel">
        const { useState, useEffect } = React;

        // â–¼â–¼â–¼â–¼â–¼ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ Ø®ÙˆØ¯ØªØ§Ù† Ø±Ø§ Ø§ÛŒÙ†Ø¬Ø§ Ø¨Ø§ Ø¯Ù‚Øª Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†ÛŒØ¯ â–¼â–¼â–¼â–¼â–¼
        const SUPABASE_URL = 'https://mbigvlhecgfjjemvmzjf.supabase.co'; // URL Ù¾Ø±ÙˆÚ˜Ù‡
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1iaWd2bGhlY2dmamplbXZtempmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njc0NTg0MDQsImV4cCI6MjA4MzAzNDQwNH0.sbv2qvAUEB3rnnsrmut_o1hsAhhyTR_o5FZiJ4zOPeo'; // Ú©Ù„ÛŒØ¯ anon
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        function App() {
            const [supabase, setSupabase] = useState(null);
            const [session, setSession] = useState(null);
            const [isSubscribed, setIsSubscribed] = useState(false);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authMode, setAuthMode] = useState('login');
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [authLoading, setAuthLoading] = useState(false);
            
            const [goldPrice, setGoldPrice] = useState(2700);
            const [silverPrice, setSilverPrice] = useState(32);
            const [usdRate, setUsdRate] = useState(108000);
            const [mesghalMarket, setMesghalMarket] = useState(48500000);
            const [geram18Market, setGeram18Market] = useState(3550000);
            const [dirhamRate, setDirhamRate] = useState(29500);
            const [uaeGoldPrice, setUaeGoldPrice] = useState(245);
            const [lastUpdate, setLastUpdate] = useState(new Date());

            useEffect(() => {
                try {
                    if (!window.supabase) throw new Error("Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡ Supabase Ù„ÙˆØ¯ Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.");
                    if (!SUPABASE_URL || SUPABASE_URL === 'YOUR_SUPABASE_URL') throw new Error("Ú©Ù„ÛŒØ¯ URL Supabase ØªÙ†Ø¸ÛŒÙ… Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.");
                    
                    const client = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    setSupabase(client);
                } catch (err) {
                    setError(err.message);
                    setLoading(false);
                }
            }, []);

            useEffect(() => {
                if (!supabase) {
                    if (!error) setLoading(false);
                    return;
                }
                const initAuth = async () => {
                    try {
                        const { data: { session } } = await supabase.auth.getSession();
                        setSession(session);
                        if (session?.user) {
                            const { data: profile } = await supabase.from('profiles').select('is_subscribed').eq('id', session.user.id).single();
                            setIsSubscribed(profile?.is_subscribed || false);
                        }
                    } catch (err) { console.error('Error fetching session:', err); } 
                    finally { setLoading(false); }
                };
                initAuth();
                const { data: { subscription } } = supabase.auth.onAuthStateChange(async (_event, newSession) => {
                    setSession(newSession);
                    if (newSession?.user) {
                        const { data: profile } = await supabase.from('profiles').select('is_subscribed').eq('id', newSession.user.id).single();
                        setIsSubscribed(profile?.is_subscribed || false);
                    } else { setIsSubscribed(false); }
                });
                return () => subscription?.unsubscribe();
            }, [supabase]);

            const handleAuth = async (e) => { e.preventDefault(); setAuthLoading(true); try { if (authMode === 'signup') { const { error } = await supabase.auth.signUp({ email, password }); if (error) throw error; alert('âœ… Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ù…ÙˆÙÙ‚! Ù„Ø·ÙØ§ Ø§ÛŒÙ…ÛŒÙ„ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø±Ø§ÛŒ ÙØ¹Ø§Ù„â€ŒØ³Ø§Ø²ÛŒ Ú†Ú© Ú©Ù†ÛŒØ¯.'); setShowAuthModal(false); } else { const { error } = await supabase.auth.signInWithPassword({ email, password }); if (error) throw error; setShowAuthModal(false); } } catch (err) { if (err.message.includes('Invalid login credentials')) { alert('âŒ Ø§ÛŒÙ…ÛŒÙ„ ÛŒØ§ Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± Ø§Ø´ØªØ¨Ø§Ù‡ Ø§Ø³Øª'); } else if (err.message.includes('User already registered')) { alert('âš ï¸ Ø§ÛŒÙ† Ø§ÛŒÙ…ÛŒÙ„ Ù‚Ø¨Ù„Ø§ Ø«Ø¨Øª Ø´Ø¯Ù‡ Ø§Ø³Øª.'); } else { alert('Ø®Ø·Ø§: ' + err.message); } } finally { setAuthLoading(false); } };
            const handleLogout = async () => { if(!supabase) return; setLoading(true); await supabase.auth.signOut(); setLoading(false); };
            const handleManualInput = (setter, type, currentValue) => { const value = prompt(`Ù‚ÛŒÙ…Øª Ø¬Ø¯ÛŒØ¯ ${type} Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:`, currentValue); if (value) { const numValue = parseFloat(value.replace(/,/g, '')); if (!isNaN(numValue) && numValue > 0) setter(numValue); } };
            const openAuthModal = (mode) => { setAuthMode(mode); setShowAuthModal(true); setEmail(''); setPassword(''); };
            
            const formatNumber = (num) => new Intl.NumberFormat('fa-IR').format(Math.round(num));
            const mesghalTheo = (goldPrice * usdRate) / 9.5742;
            const diffMesghal = mesghalTheo - mesghalMarket;
            const mesghalPercent = ((diffMesghal / mesghalMarket) * 100).toFixed(2);
            const geram18Theo = ((goldPrice / 31.1) * usdRate) * 0.75;
            const diffGeram18 = geram18Theo - geram18Market;
            const geram18Percent = ((diffGeram18 / geram18Market) * 100).toFixed(2);
            const getSignal = (diff) => diff > 0 ? { text: "Ø­Ø¨Ø§Ø¨ Ù…Ø«Ø¨Øª", color: "red", icon: "ğŸ“ˆ" } : { text: "Ø­Ø¨Ø§Ø¨ Ù…Ù†ÙÛŒ", color: "green", icon: "ğŸ“‰" };
            const signalMesghal = getSignal(diffMesghal);
            const signalGeram18 = getSignal(diffGeram18);

            const PriceCard = ({ title, value, unit, icon, onEdit }) => (<div className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl p-4 hover:translate-y-[-5px] transition-all duration-300" style={{borderLeft: '4px solid #f59e0b'}}><div className="flex justify-between mb-2"><span className="text-gray-400 text-xs">{icon} {title}</span>{isSubscribed && (<button onClick={onEdit} className="bg-white/10 hover:bg-white/20 px-2 py-1 rounded-lg text-xs transition-colors">âœï¸</button>)}</div><div className="text-xl font-bold text-amber-400 mb-1">{formatNumber(value)}</div><div className="text-[10px] text-gray-500">{unit}</div></div>);
            const AnalysisCard = ({ title, badge, marketPrice, theoPrice, signal }) => { const diff = marketPrice - theoPrice; const percent = marketPrice ? ((diff / marketPrice) * 100).toFixed(2) : 0; const borderColor = signal.color === 'green' ? '#10b981' : '#ef4444'; const textColor = signal.color === 'green' ? 'text-green-500' : 'text-red-500'; return (<div className="bg-white/5 backdrop-blur-xl border border-white/10 rounded-2xl overflow-hidden mb-4"><div className="bg-gradient-to-r from-amber-500 via-orange-600 to-yellow-700 p-4"><div className="flex items-center gap-3"><div className="w-10 h-10 bg-white/20 rounded-xl flex items-center justify-center"><span className="text-xl">{signal.icon}</span></div><div><h3 className="font-bold text-white text-lg">{title}</h3><span className="text-xs text-white/70">{badge}</span></div></div></div><div className="p-4"><div className="grid grid-cols-2 gap-3 mb-3"><div className="bg-white/5 p-3 rounded-xl"><div className="text-xs text-gray-400 mb-1">Ù‚ÛŒÙ…Øª Ø¨Ø§Ø²Ø§Ø±</div><div className="text-base font-bold text-white">{formatNumber(marketPrice)}</div></div><div className="bg-white/5 p-3 rounded-xl"><div className="text-xs text-gray-400 mb-1">Ù‚ÛŒÙ…Øª ØªØ¦ÙˆØ±ÛŒ</div><div className="text-base font-bold text-white">{formatNumber(theoPrice)}</div></div></div><div className="bg-white/5 p-4 rounded-xl" style={{border: `1px solid ${borderColor}`}}><div className="flex justify-between mb-2"><span className="text-xs text-gray-300">Ø§Ø®ØªÙ„Ø§Ù Ù‚ÛŒÙ…Øª</span><span className={`text-base font-bold ${textColor}`}>{percent}%</span></div><div className={`text-3xl font-bold ${textColor} mb-2`}>{formatNumber(Math.abs(diff))}</div><div className={`text-sm font-bold ${textColor}`}>{signal.icon} {signal.text}</div></div></div></div>); };
            const AuthModal = () => (<div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4"><div className="bg-slate-800 p-8 rounded-2xl w-full max-w-md"><h2 className="text-white text-2xl mb-2 font-bold">{authMode === 'signup' ? 'ğŸ‰ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…' : 'ğŸ‘‹ ÙˆØ±ÙˆØ¯'}</h2><p className="text-gray-400 mb-6 text-sm">{authMode === 'signup' ? 'Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÛŒØ¯ Ø¨Ø³Ø§Ø²ÛŒØ¯' : 'Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø®ÙˆØ¯ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯'}</p><form onSubmit={handleAuth} className="space-y-4"><div><label className="text-gray-300 text-sm block mb-2">Ø§ÛŒÙ…ÛŒÙ„</label><input type="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="example@email.com" className="w-full bg-slate-700 text-white p-3 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500" dir="ltr" required disabled={authLoading}/></div><div><label className="text-gray-300 text-sm block mb-2">Ø±Ù…Ø² Ø¹Ø¨ÙˆØ±</label><input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Ø­Ø¯Ø§Ù‚Ù„ Û¶ Ú©Ø§Ø±Ø§Ú©ØªØ±" className="w-full bg-slate-700 text-white p-3 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-green-500" minLength="6" required disabled={authLoading}/></div><button type="submit" className="w-full bg-green-500 hover:bg-green-600 p-3 rounded-lg text-white font-bold transition disabled:opacity-50" disabled={authLoading}>{authLoading ? 'â³ Ù„Ø·ÙØ§ ØµØ¨Ø± Ú©Ù†ÛŒØ¯...' : (authMode === 'signup' ? 'Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…' : 'ÙˆØ±ÙˆØ¯')}</button></form><div className="mt-4 pt-4 border-t border-gray-600"><button onClick={() => setAuthMode(authMode === 'login' ? 'signup' : 'login')} className="w-full text-green-400 p-2 hover:text-green-300 transition text-sm" disabled={authLoading}>{authMode === 'login' ? 'ğŸ†• Ø­Ø³Ø§Ø¨ Ù†Ø¯Ø§Ø±ÛŒØ¯ØŸ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ù†ÛŒØ¯' : 'âœ… Ù‚Ø¨Ù„Ø§ Ø«Ø¨Øªâ€ŒÙ†Ø§Ù… Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯ØŸ ÙˆØ§Ø±Ø¯ Ø´ÙˆÛŒØ¯'}</button><button onClick={() => setShowAuthModal(false)} className="w-full mt-2 text-gray-400 p-2 hover:text-white transition text-sm" disabled={authLoading}>âœ–ï¸ Ø§Ù†ØµØ±Ø§Ù</button></div></div></div>);
            
            if (error) return <div className="flex justify-center items-center min-h-screen bg-red-900 text-white p-8"><div className="text-center"><h2 className="text-2xl font-bold mb-4">Ø®Ø·Ø§ÛŒ Ø¨Ø­Ø±Ø§Ù†ÛŒ</h2><p>{error}</p><button onClick={() => window.location.reload()} className="bg-white text-red-900 px-6 py-2 rounded-lg font-bold mt-4">ØªÙ„Ø§Ø´ Ù…Ø¬Ø¯Ø¯</button></div></div>;
            if (loading) return null;
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-700 pb-24" dir="rtl">
                    <div className="sticky top-0 z-40 bg-white/5 backdrop-blur-xl border-b border-white/10">
                        <div className="max-w-6xl mx-auto p-4 flex justify-between items-center">
                            <h1 className="text-xl font-black text-white">Ú¯Ù„Ø¯ÛŒØ§Ø± {isSubscribed && <span className="text-green-400">PRO</span>}</h1>
                            {session ? ( <div className="flex items-center gap-3"><span className="text-gray-300 text-sm hidden md:block">{session.user.email}</span><button onClick={handleLogout} className="bg-red-500/80 hover:bg-red-600 px-4 py-2 rounded-xl text-sm text-white transition">Ø®Ø±ÙˆØ¬</button></div> ) : (
                                <div className="flex gap-2"><button onClick={() => openAuthModal('login')} className="bg-green-500/80 hover:bg-green-600 px-4 py-2 rounded-xl text-sm text-white transition">ÙˆØ±ÙˆØ¯</button><button onClick={() => openAuthModal('signup')} className="bg-blue-500/80 hover:bg-blue-600 px-4 py-2 rounded-xl text-sm text-white transition">Ø«Ø¨Øªâ€ŒÙ†Ø§Ù…</button></div>
                            )}
                        </div>
                    </div>

                    {showAuthModal && <AuthModal />}
                    
                    {!session ? (
                        <div className="text-center p-10 max-w-2xl mx-auto"><div className="mb-8"><h2 className="text-4xl font-bold text-white mb-4 animate-float">Ø¨Ù‡ Ú¯Ù„Ø¯ÛŒØ§Ø± Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯ ğŸ’</h2><p className="text-gray-300 text-lg">ØªØ­Ù„ÛŒÙ„ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø¨Ø§Ø²Ø§Ø± Ø·Ù„Ø§</p></div><div className="flex gap-4 justify-center"><button onClick={() => openAuthModal('signup')} className="bg-green-500 hover:bg-green-600 px-8 py-3 rounded-xl text-white font-bold transition text-lg">ğŸš€ Ø´Ø±ÙˆØ¹ Ø±Ø§ÛŒÚ¯Ø§Ù†</button></div></div>
                    ) : (
                        <div className="max-w-6xl mx-auto p-4">
                           <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-6">
                               <PriceCard title="Ø§Ù†Ø³ Ø·Ù„Ø§" value={goldPrice} unit="Ø¯Ù„Ø§Ø±" icon="ğŸŒ" onEdit={() => handleManualInput(setGoldPrice, 'Ø§Ù†Ø³ Ø·Ù„Ø§', goldPrice)} />
                               <PriceCard title="Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡" value={silverPrice} unit="Ø¯Ù„Ø§Ø±" icon="âšª" onEdit={() => handleManualInput(setSilverPrice, 'Ø§Ù†Ø³ Ù†Ù‚Ø±Ù‡', silverPrice)} />
                               <PriceCard title="Ø¯Ù„Ø§Ø±" value={usdRate} unit="ØªÙˆÙ…Ø§Ù†" icon="ğŸ’µ" onEdit={() => handleManualInput(setUsdRate, 'Ø¯Ù„Ø§Ø±', usdRate)} />
                               <PriceCard title="Ù…Ø«Ù‚Ø§Ù„" value={mesghalMarket} unit="ØªÙˆÙ…Ø§Ù†" icon="âš–ï¸" onEdit={() => handleManualInput(setMesghalMarket, 'Ù…Ø«Ù‚Ø§Ù„', mesghalMarket)} />
                               <PriceCard title="18 Ø¹ÛŒØ§Ø±" value={geram18Market} unit="Øª/Ú¯Ø±Ù…" icon="ğŸ’" onEdit={() => handleManualInput(setGeram18Market, '18 Ø¹ÛŒØ§Ø±', geram18Market)} />
                               <PriceCard title="Ø¯Ø±Ù‡Ù…" value={dirhamRate} unit="ØªÙˆÙ…Ø§Ù†" icon="ğŸ‡¦ğŸ‡ª" onEdit={() => handleManualInput(setDirhamRate, 'Ø¯Ø±Ù‡Ù…', dirhamRate)} />
                           </div>
                           <AnalysisCard title="ØªØ­Ù„ÛŒÙ„ A (Ù…Ø«Ù‚Ø§Ù„)" badge="ÙØ±Ù…ÙˆÙ„ Ø§Ø±Ø²Ø´ Ø°Ø§ØªÛŒ" marketPrice={mesghalMarket} theoPrice={mesghalTheo} signal={signalMesghal} />
                           <AnalysisCard title="ØªØ­Ù„ÛŒÙ„ B (Û±Û¸ Ø¹ÛŒØ§Ø±)" badge="ÙØ±Ù…ÙˆÙ„ Ø§Ø±Ø²Ø´ Ø°Ø§ØªÛŒ" marketPrice={geram18Market} theoPrice={geram18Theo} signal={signalGeram18} />
                           {!isSubscribed && (
                               <div className="bg-amber-500/20 border border-amber-500/50 rounded-2xl p-6 mt-6 text-center">
                                   <h2 className="text-xl font-bold text-white mb-2">Ø§Ø±ØªÙ‚Ø§ Ø¨Ù‡ Ù†Ø³Ø®Ù‡ Ù¾Ø±Ùˆ</h2>
                                   <p className="text-amber-200 text-sm mb-3">Ø´Ù…Ø§ Ø§Ø² Ù†Ø³Ø®Ù‡ Ø±Ø§ÛŒÚ¯Ø§Ù† Ø¨Ø§ Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒÚ©Ù†ÛŒØ¯. Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¯Ù† Ù‚ÛŒÙ…Øªâ€ŒÙ‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡ Ùˆ ØªØ­Ù„ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ±ØŒ Ø§Ø´ØªØ±Ø§Ú© ØªÙ‡ÛŒÙ‡ Ú©Ù†ÛŒØ¯.</p>
                               </div>
                           )}
                        </div>
                    )}
                </div>
            );
        }

        // Ø³Ø±Ú©Ø§Ø±Ú¯Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯
        function initApp() {
            const container = document.getElementById('root');
            if(container) {
                const root = ReactDOM.createRoot(container);
                root.render(<App />);
            }
        }
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
